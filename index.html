<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <title>Rifa Semanal ‚Äî 1.000 MZN</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,sans-serif;background:#000;color:#fff;min-height:100vh;padding:.4rem;display:flex;align-items:center;justify-content:center}
    .card{background:#fff;color:#000;padding:.4rem;border:1px solid #000;border-radius:5px;width:100%;text-align:center;box-shadow:0 2px 5px rgba(0,0,0,.3)}
    h2{font-size:1rem;font-weight:700;margin-bottom:.15rem}
    .prize{font-size:1.2rem;font-weight:800;margin:.15rem 0}
    .info{font-size:.65rem;margin-bottom:.5rem;color:#333}
    .details{background:#f9f9f9;padding:.3rem;border-radius:3px;margin-bottom:.5rem;font-size:.6rem;border:1px solid #ddd}
    .details ul{list-style:none}
    .details li{margin-bottom:.15rem;padding-left:.7rem}
    .details li:before{content:"‚úì";position:absolute;left:.15rem}
    .field{margin-bottom:.4rem;text-align:left}
    label{display:block;font-size:.6rem;font-weight:500;margin-bottom:.1rem}
    input,select{width:100%;padding:.3rem;border:1px solid #000;border-radius:2px;font-size:.7rem}
    input:focus,select:focus{outline:0;border-color:#333;box-shadow:0 0 0 1px rgba(0,0,0,.2)}
    button{width:100%;padding:.3rem;background:#000;color:#fff;border:none;border-radius:2px;font-size:.65rem;font-weight:600;cursor:pointer}
    button:hover:not(:disabled){background:#333}
    button:disabled{opacity:.5;cursor:not-allowed}
    .status{margin-top:.5rem;padding:.2rem;border-radius:2px;font-size:.6rem;border:1px solid transparent}
    .status.loading,.status.success,.status.error{background:#fff;border-color:#000}
    .money{font-size:1.2rem;margin-bottom:.15rem}
    .footer{margin-top:.5rem;font-size:.55rem;color:#666}
    .ticket-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(30px,1fr));gap:2px;margin-bottom:.5rem;max-height:80px;overflow-y:auto;padding:.2rem;background:#f9f9f9;border-radius:3px;border:1px solid #ddd}
    .ticket-btn{padding:.15rem;background:#fff;border:1px solid #000;border-radius:2px;font-size:.6rem;cursor:pointer}
    .ticket-btn:hover,.ticket-btn.selected{background:#000;color:#fff}
    .ticket-btn:disabled{background:#ddd;color:#666;cursor:not-allowed}
    .gift-box{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:1000}
    .gift-box.active{display:flex}
    .gift-content{background:#fff;padding:.5rem;border-radius:4px;text-align:center;animation:openGift .6s ease forwards}
    .gift-content .ticket-code{font-size:.8rem;font-weight:700;margin:.5rem 0}
    .close-gift{position:absolute;top:4px;right:4px;background:0;border:0;font-size:.7rem;cursor:pointer}
    .last-result,.countdown{background:#f9f9f9;padding:.3rem;border-radius:3px;margin-top:.5rem;font-size:.6rem;border:1px solid #ddd;color:#000}
    .countdown{font-weight:600}
    @keyframes openGift{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2);opacity:1}100%{transform:scale(1);opacity:1}}
    @media (max-width:480px){.card{padding:.3rem}h2{font-size:.85rem}.prize{font-size:1rem}.money{font-size:1rem}.ticket-grid{grid-template-columns:repeat(auto-fit,minmax(25px,1fr))}}
    @media (min-width:768px){.card{padding:.8rem;max-width:350px}}
  </style>
</head>
<body>
  <div class="card">
    <div class="money">üí∞</div>
    <h2>Rifa Semanal</h2>
    <div class="prize">1.000 MZN</div>
    <p class="info">20 MZN por bilhete<br>Sorteio: Domingo 23:59</p>
    <div class="details">
      <ul>
        <li>Bilhetes: 300</li>
        <li>Pr√™mio via M-Pesa</li>
        <li>Sorteio: @rifa_mz</li>
        <li>Resultado nesta p√°gina</li>
      </ul>
    </div>
    <div class="field">
      <label>N√∫mero (1-300)</label>
      <div class="ticket-grid" id="ticketGrid"></div>
      <input type="hidden" id="selectedTicket" required>
    </div>
    <form id="rifaForm">
      <div class="field">
        <label>Nome</label>
        <input id="name" placeholder="Jo√£o Silva" required>
      </div>
      <div class="field">
        <label>Bilhetes</label>
        <select id="quantity">
          <option value="1">1 (20 MZN)</option>
          <option value="2">2 (40 MZN)</option>
          <option value="5">5 (100 MZN)</option>
          <option value="10">10 (200 MZN)</option>
        </select>
      </div>
      <button type="submit" id="buyBtn">Comprar</button>
    </form>
    <div id="status" class="status"></div>
    <div class="last-result">√öltima Rifa: Bilhete #42 Assunto: Pr√™mio em Dinheiro via M-Pesa</div>
    <div class="countdown" id="countdown">Aguardando Resultados: --</div>
    <div class="footer">Suporte: #rifa_mz</div>
  </div>
  <div class="gift-box" id="giftBox">
    <div class="gift-content">
      <button class="close-gift" id="closeGift">‚úï</button>
      <div>üéÅ</div>
      <div class="ticket-code" id="ticketCode"></div>
      <p>N√∫mero reservado!</p>
    </div>
  </div>
<script>
let takenTickets=[2,5,10,150];const totalTickets=300,ticketGrid=document.getElementById("ticketGrid"),selectedTicketInput=document.getElementById("selectedTicket"),giftBox=document.getElementById("giftBox"),ticketCode=document.getElementById("ticketCode"),closeGift=document.getElementById("closeGift"),countdownEl=document.getElementById("countdown");function generateTicketGrid(){ticketGrid.innerHTML="";for(let t=1;t<=totalTickets;t++){const e=document.createElement("button");e.className="ticket-btn",e.textContent=t,e.dataset.ticket=t,takenTickets.includes(t)?e.disabled=!0:e.addEventListener("click",()=>selectTicket(t)),ticketGrid.appendChild(e)}}function selectTicket(t){const e=ticketGrid.querySelector(".ticket-btn.selected");e&&e.classList.remove("selected");ticketGrid.querySelector(`[data-ticket="${t}"]`).classList.add("selected"),selectedTicketInput.value=t,ticketCode.textContent=`Bilhete #${t}`,giftBox.classList.add("active")}function updateCountdown(){const t=new Date(),e=t.getDay(),i=7-e+(e===0?0:7),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+i,23,59,0),s=(n-t)/1e3,a=Math.floor(s/86400),c=Math.floor(s%86400/3600),l=Math.floor(s%3600/60),o=Math.floor(s%60);countdownEl.textContent=`Aguardando Resultados: ${a}d ${c}h ${l}m ${o}s`,s<=0&&setTimeout(updateCountdown,1e3)}closeGift.addEventListener("click",()=>{giftBox.classList.remove("active")}),generateTicketGrid(),updateCountdown(),setInterval(updateCountdown,1e3),document.getElementById("rifaForm").addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("buyBtn"),i=document.getElementById("status"),n=document.getElementById("name").value.trim(),c=parseInt(document.getElementById("quantity").value),l=selectedTicketInput.value;if(!n||!l)return i.textContent="Nome e n√∫mero obrigat√≥rios.",void(i.className="status error");e.disabled=!0,e.textContent="Processando...",i.textContent="Iniciando pagamento...",i.className="status loading";try{const t=await fetch("/api/create-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,qty:c,ticket:l,amount:20*c})}),s=await t.json();if(!t.ok)throw new Error(s.message||"Erro no pagamento");i.innerHTML=s.checkout_url?`Pagar: <a href="${s.checkout_url}" target="_blank" style="color:#000;font-weight:600">M-Pesa</a>`:"Aguarde SMS (*150*00#).",i.className="status success",pollPayment(s.payment_id,l)}catch(t){i.textContent="Erro: "+t.message,i.className="status error"}finally{e.disabled=!1,e.textContent="Comprar"}});async function pollPayment(t,e){let i=0;const n=setInterval(async()=>{if(i++,i>20)return void clearInterval(n);try{const s=await fetch(`/api/payment-status/${t}`),a=await s.json();a.status==="confirmed"&&(takenTickets.push(parseInt(e)),generateTicketGrid(),clearInterval(n),document.getElementById("status").innerHTML="Confirmado!<br>Bilhetes reservados.<br>Boa sorte!",document.getElementById("status").className="status success")}catch(t){}},4e3)}
</script>
</body>
</html>
