<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rifa Di√°ria - Sistema de Apostas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        .ticket-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 min-h-screen text-white">
    
    <!-- Tela de Login/Registro -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">üé≤ Rifa Di√°ria</h1>
                <p class="text-gray-600">Sistema de Apostas Online</p>
            </div>

            <!-- Formul√°rio de Login -->
            <div id="loginForm">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Entrar</h2>
                <form id="loginFormElement" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2">N√∫mero M-Pesa</label>
                        <input type="text" id="loginMpesa" placeholder="84XXXXXXX ou 85XXXXXXX" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none text-gray-800"
                               required pattern="8[45]\d{7}">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Senha</label>
                        <input type="password" id="loginPassword" placeholder="M√≠nimo 4 caracteres"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none text-gray-800"
                               required minlength="4">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition duration-200">
                        Entrar
                    </button>
                </form>
                <p class="text-center mt-6 text-gray-600">
                    Ainda n√£o tem conta? 
                    <button onclick="toggleAuthForm()" class="text-blue-600 hover:text-blue-700 font-semibold">Registrar</button>
                </p>
            </div>

            <!-- Formul√°rio de Registro -->
            <div id="registerForm" class="hidden">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Criar Conta</h2>
                <form id="registerFormElement" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2">Nome Completo</label>
                        <input type="text" id="registerName" placeholder="Seu nome completo"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none text-gray-800"
                               required>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">N√∫mero M-Pesa</label>
                        <input type="text" id="registerMpesa" placeholder="84XXXXXXX ou 85XXXXXXX"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none text-gray-800"
                               required pattern="8[45]\d{7}">
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2">Senha</label>
                        <input type="password" id="registerPassword" placeholder="M√≠nimo 4 caracteres"
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none text-gray-800"
                               required minlength="4">
                    </div>
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition duration-200">
                        Criar Conta
                    </button>
                </form>
                <p class="text-center mt-6 text-gray-600">
                    J√° tem conta? 
                    <button onclick="toggleAuthForm()" class="text-blue-600 hover:text-blue-700 font-semibold">Entrar</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Tela Principal da Rifa -->
    <div id="rifaScreen" class="hidden min-h-screen p-4 pb-20">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">üé≤ Rifa Di√°ria</h1>
                        <p class="text-gray-600">Bem-vindo, <span id="userName" class="font-semibold"></span></p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Saldo Atual</p>
                            <p class="text-2xl font-bold text-green-600"><span id="userBalance">500</span> MZN</p>
                        </div>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition duration-200">
                            Sair
                        </button>
                    </div>
                </div>
            </div>

            <!-- Contador Regressivo -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl shadow-xl p-6 mb-6 fade-in">
                <div class="text-center">
                    <p class="text-lg mb-2">‚è∞ Pr√≥ximo Sorteio em:</p>
                    <p id="countdown" class="text-4xl font-bold pulse-animation">--:--:--</p>
                    <p class="text-sm mt-2 opacity-90">Sorteios: 10:00 | 15:00 | 19:00 | 00:00</p>
                </div>
            </div>

            <!-- Sele√ß√£o de N√∫meros -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Escolha 5 N√∫meros (1-100)</h2>
                <p class="text-gray-600 mb-4">Custo: <span class="font-bold text-green-600">25 MZN</span> por aposta</p>
                
                <div id="numbersGrid" class="grid grid-cols-10 gap-2 mb-6">
                    <!-- N√∫meros gerados via JavaScript -->
                </div>

                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <p class="text-gray-700">N√∫meros selecionados: <span id="selectedCount" class="font-bold text-blue-600">0</span>/5</p>
                        <div id="selectedNumbers" class="flex gap-2 mt-2 flex-wrap"></div>
                    </div>
                    <button id="buyButton" onclick="buyTicket()" disabled
                            class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-semibold px-8 py-3 rounded-lg transition duration-200">
                        Comprar Bilhete
                    </button>
                </div>
            </div>

            <!-- Hist√≥rico do Jogador -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìã Minhas Apostas</h2>
                <div id="playerHistory" class="space-y-3">
                    <p class="text-gray-500 text-center py-4">Nenhuma aposta ainda</p>
                </div>
            </div>

            <!-- Hist√≥rico de Sorteios -->
            <div class="bg-white rounded-2xl shadow-xl p-6 fade-in">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üèÜ √öltimos Sorteios</h2>
                <div id="drawHistory" class="space-y-3">
                    <p class="text-gray-500 text-center py-4">Nenhum sorteio realizado ainda</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Compra Confirmada -->
    <div id="purchaseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full fade-in">
            <div class="text-center">
                <div class="text-6xl mb-4">‚úÖ</div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Compra Confirmada!</h2>
                <p class="text-gray-600 mb-2">Seus n√∫meros:</p>
                <div id="purchasedNumbers" class="flex justify-center gap-2 mb-4 flex-wrap"></div>
                <p class="text-gray-600 mb-6">Boa sorte no pr√≥ximo sorteio!</p>
                <button onclick="closePurchaseModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-8 py-3 rounded-lg transition duration-200">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Resultado do Sorteio -->
    <div id="resultModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full fade-in">
            <div class="text-center">
                <div id="resultIcon" class="text-6xl mb-4">üéâ</div>
                <h2 id="resultTitle" class="text-3xl font-bold text-gray-800 mb-4">Resultado do Sorteio</h2>
                <p class="text-gray-600 mb-2">N√∫meros sorteados:</p>
                <div id="drawnNumbers" class="flex justify-center gap-2 mb-4 flex-wrap"></div>
                <div id="resultMessage" class="text-lg font-semibold mb-6"></div>
                <button onclick="closeResultModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-8 py-3 rounded-lg transition duration-200">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONSTANTES E VARI√ÅVEIS GLOBAIS ==========
        const TICKET_COST = 25;
        const INITIAL_BALANCE = 500;
        const DRAW_TIMES = ['10:00', '15:00', '19:00', '00:00'];
        
        let currentUser = null;
        let selectedNumbers = [];
        let balance = INITIAL_BALANCE;

        // ========== FUN√á√ïES DE AUTENTICA√á√ÉO ==========
        
        function toggleAuthForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            loginForm.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
        }

        function register(name, mpesa, password) {
            const users = JSON.parse(localStorage.getItem('rifa_users_v1') || '{}');
            
            if (users[mpesa]) {
                alert('Este n√∫mero M-Pesa j√° est√° registrado!');
                return false;
            }

            users[mpesa] = { name, password };
            localStorage.setItem('rifa_users_v1', JSON.stringify(users));
            
            // Inicializar saldo do novo usu√°rio
            localStorage.setItem(`rifa_balance_${mpesa}`, INITIAL_BALANCE.toString());
            
            alert('Conta criada com sucesso! Fa√ßa login para continuar.');
            toggleAuthForm();
            return true;
        }

        function login(mpesa, password) {
            const users = JSON.parse(localStorage.getItem('rifa_users_v1') || '{}');
            
            if (!users[mpesa]) {
                alert('N√∫mero M-Pesa n√£o encontrado!');
                return false;
            }

            if (users[mpesa].password !== password) {
                alert('Senha incorreta!');
                return false;
            }

            currentUser = { mpesa, name: users[mpesa].name };
            sessionStorage.setItem('rifa_session', JSON.stringify(currentUser));
            
            // Carregar saldo do usu√°rio
            balance = parseInt(localStorage.getItem(`rifa_balance_${mpesa}`) || INITIAL_BALANCE);
            
            showRifaScreen();
            return true;
        }

        function logout() {
            sessionStorage.removeItem('rifa_session');
            currentUser = null;
            selectedNumbers = [];
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('rifaScreen').classList.add('hidden');
        }

        function showRifaScreen() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('rifaScreen').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;
            updateBalance();
            generateNumbersGrid();
            updateCountdown();
            loadPlayerHistory();
            loadDrawHistory();
            checkPendingDraws();
        }

        // ========== FUN√á√ïES DA RIFA ==========

        function generateNumbersGrid() {
            const grid = document.getElementById('numbersGrid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= 100; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.className = 'ticket-hover bg-gray-100 hover:bg-blue-500 hover:text-white text-gray-800 font-semibold py-3 rounded-lg transition duration-200';
                button.onclick = () => toggleNumber(i, button);
                grid.appendChild(button);
            }
        }

        function toggleNumber(number, button) {
            const index = selectedNumbers.indexOf(number);
            
            if (index > -1) {
                selectedNumbers.splice(index, 1);
                button.classList.remove('bg-blue-600', 'text-white');
                button.classList.add('bg-gray-100', 'text-gray-800');
            } else {
                if (selectedNumbers.length >= 5) {
                    alert('Voc√™ j√° selecionou 5 n√∫meros!');
                    return;
                }
                selectedNumbers.push(number);
                button.classList.remove('bg-gray-100', 'text-gray-800');
                button.classList.add('bg-blue-600', 'text-white');
            }

            selectedNumbers.sort((a, b) => a - b);
            updateSelectedDisplay();
        }

        function updateSelectedDisplay() {
            document.getElementById('selectedCount').textContent = selectedNumbers.length;
            
            const container = document.getElementById('selectedNumbers');
            container.innerHTML = selectedNumbers.map(num => 
                `<span class="bg-blue-600 text-white px-3 py-1 rounded-full font-semibold">${num}</span>`
            ).join('');

            document.getElementById('buyButton').disabled = selectedNumbers.length !== 5;
        }

        function buyTicket() {
            if (selectedNumbers.length !== 5) {
                alert('Selecione exatamente 5 n√∫meros!');
                return;
            }

            if (balance < TICKET_COST) {
                alert('Saldo insuficiente!');
                return;
            }

            // Deduzir saldo
            balance -= TICKET_COST;
            updateBalance();

            // Salvar compra pendente
            const purchases = JSON.parse(localStorage.getItem('rifa_purchases_v1') || '[]');
            const purchase = {
                id: Date.now(),
                user: currentUser.mpesa,
                numbers: [...selectedNumbers],
                timestamp: new Date().toISOString(),
                cost: TICKET_COST
            };
            purchases.push(purchase);
            localStorage.setItem('rifa_purchases_v1', JSON.stringify(purchases));

            // Mostrar modal de confirma√ß√£o
            showPurchaseModal();

            // Resetar sele√ß√£o
            selectedNumbers = [];
            generateNumbersGrid();
            updateSelectedDisplay();
            loadPlayerHistory();
        }

        function updateBalance() {
            document.getElementById('userBalance').textContent = balance;
            localStorage.setItem(`rifa_balance_${currentUser.mpesa}`, balance.toString());
        }

        // ========== FUN√á√ïES DE SORTEIO ==========

        function getNextDrawTime() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            for (let time of DRAW_TIMES) {
                const [hours, minutes] = time.split(':').map(Number);
                const drawTime = new Date(today);
                drawTime.setHours(hours, minutes, 0, 0);
                
                if (drawTime > now) {
                    return drawTime;
                }
            }
            
            // Se passou de todos os hor√°rios de hoje, pr√≥ximo √© 10:00 de amanh√£
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);
            return tomorrow;
        }

        function updateCountdown() {
            const countdownElement = document.getElementById('countdown');
            
            setInterval(() => {
                const now = new Date();
                const nextDraw = getNextDrawTime();
                const diff = nextDraw - now;

                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                countdownElement.textContent = 
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                // Verificar se √© hora de sortear
                if (hours === 0 && minutes === 0 && seconds === 0) {
                    performDraw();
                }
            }, 1000);
        }

        function checkPendingDraws() {
            const lastDraw = localStorage.getItem('rifa_last_draw_time');
            const now = new Date();
            
            if (!lastDraw) {
                return;
            }

            const lastDrawDate = new Date(lastDraw);
            const nextScheduledDraw = getNextDrawTime();
            
            // Se o √∫ltimo sorteio foi h√° mais de 4 horas e h√° compras pendentes, realizar sorteio
            const hoursSinceLastDraw = (now - lastDrawDate) / (1000 * 60 * 60);
            const purchases = JSON.parse(localStorage.getItem('rifa_purchases_v1') || '[]');
            
            if (hoursSinceLastDraw >= 4 && purchases.length > 0) {
                performDraw();
            }
        }

        function performDraw() {
            const purchases = JSON.parse(localStorage.getItem('rifa_purchases_v1') || '[]');
            
            if (purchases.length === 0) {
                return;
            }

            // Gerar 5 n√∫meros aleat√≥rios
            const drawnNumbers = [];
            while (drawnNumbers.length < 5) {
                const num = Math.floor(Math.random() * 100) + 1;
                if (!drawnNumbers.includes(num)) {
                    drawnNumbers.push(num);
                }
            }
            drawnNumbers.sort((a, b) => a - b);

            // Verificar vencedores
            const results = [];
            purchases.forEach(purchase => {
                const matches = purchase.numbers.filter(num => drawnNumbers.includes(num)).length;
                let prize = 0;
                let status = 'Perdeu';

                if (matches === 3) {
                    prize = 25;
                    status = 'Reembolso';
                } else if (matches === 5) {
                    prize = 5000;
                    status = 'GANHOU!';
                }

                results.push({
                    user: purchase.user,
                    numbers: purchase.numbers,
                    matches,
                    prize,
                    status
                });

                // Atualizar saldo do usu√°rio
                if (prize > 0 && purchase.user === currentUser.mpesa) {
                    balance += prize;
                    updateBalance();
                }
            });

            // Salvar hist√≥rico do sorteio
            const history = JSON.parse(localStorage.getItem('rifa_history_v1') || '[]');
            history.unshift({
                timestamp: new Date().toISOString(),
                numbers: drawnNumbers,
                results
            });
            localStorage.setItem('rifa_history_v1', JSON.stringify(history.slice(0, 10)));

            // Salvar hist√≥rico do jogador
            const playerHistory = JSON.parse(localStorage.getItem('rifa_player_history_v1') || '{}');
            if (!playerHistory[currentUser.mpesa]) {
                playerHistory[currentUser.mpesa] = [];
            }
            
            const userResults = results.filter(r => r.user === currentUser.mpesa);
            userResults.forEach(result => {
                playerHistory[currentUser.mpesa].unshift({
                    timestamp: new Date().toISOString(),
                    drawnNumbers,
                    myNumbers: result.numbers,
                    matches: result.matches,
                    prize: result.prize,
                    status: result.status
                });
            });
            localStorage.setItem('rifa_player_history_v1', JSON.stringify(playerHistory));

            // Limpar compras pendentes
            localStorage.setItem('rifa_purchases_v1', '[]');
            localStorage.setItem('rifa_last_draw_time', new Date().toISOString());

            // Mostrar resultado para o usu√°rio atual
            if (userResults.length > 0) {
                showResultModal(drawnNumbers, userResults[0]);
            }

            loadPlayerHistory();
            loadDrawHistory();
        }

        // ========== FUN√á√ïES DE HIST√ìRICO ==========

        function loadPlayerHistory() {
            const playerHistory = JSON.parse(localStorage.getItem('rifa_player_history_v1') || '{}');
            const userHistory = playerHistory[currentUser.mpesa] || [];
            const container = document.getElementById('playerHistory');

            if (userHistory.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma aposta ainda</p>';
                return;
            }

            container.innerHTML = userHistory.slice(0, 5).map(entry => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <p class="text-sm text-gray-600">${new Date(entry.timestamp).toLocaleString('pt-BR')}</p>
                            <p class="font-semibold text-gray-800">Meus n√∫meros: ${entry.myNumbers.join(', ')}</p>
                            <p class="text-sm text-gray-600">Sorteados: ${entry.drawnNumbers.join(', ')}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-semibold ${
                            entry.status === 'GANHOU!' ? 'bg-green-100 text-green-800' :
                            entry.status === 'Reembolso' ? 'bg-blue-100 text-blue-800' :
                            'bg-gray-100 text-gray-800'
                        }">
                            ${entry.status}
                        </span>
                    </div>
                    <p class="text-sm">Acertos: <span class="font-bold">${entry.matches}</span> | Pr√™mio: <span class="font-bold text-green-600">${entry.prize} MZN</span></p>
                </div>
            `).join('');
        }

        function loadDrawHistory() {
            const history = JSON.parse(localStorage.getItem('rifa_history_v1') || '[]');
            const container = document.getElementById('drawHistory');

            if (history.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum sorteio realizado ainda</p>';
                return;
            }

            container.innerHTML = history.slice(0, 5).map(draw => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <p class="text-sm text-gray-600 mb-2">${new Date(draw.timestamp).toLocaleString('pt-BR')}</p>
                    <p class="font-semibold text-gray-800">N√∫meros: ${draw.numbers.join(', ')}</p>
                    <p class="text-sm text-gray-600 mt-1">${draw.results.length} apostas participaram</p>
                </div>
            `).join('');
        }

        // ========== FUN√á√ïES DE MODAL ==========

        function showPurchaseModal() {
            const modal = document.getElementById('purchaseModal');
            const numbersContainer = document.getElementById('purchasedNumbers');
            
            numbersContainer.innerHTML = selectedNumbers.map(num => 
                `<span class="bg-blue-600 text-white px-4 py-2 rounded-full font-bold text-lg">${num}</span>`
            ).join('');
            
            modal.classList.remove('hidden');
        }

        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
        }

        function showResultModal(drawnNumbers, result) {
            const modal = document.getElementById('resultModal');
            const numbersContainer = document.getElementById('drawnNumbers');
            const messageContainer = document.getElementById('resultMessage');
            const iconContainer = document.getElementById('resultIcon');
            const titleContainer = document.getElementById('resultTitle');

            numbersContainer.innerHTML = drawnNumbers.map(num => 
                `<span class="bg-purple-600 text-white px-4 py-2 rounded-full font-bold text-lg">${num}</span>`
            ).join('');

            if (result.status === 'GANHOU!') {
                iconContainer.textContent = 'üéâ';
                titleContainer.textContent = 'PARAB√âNS!';
                messageContainer.innerHTML = `<p class="text-green-600">Voc√™ acertou 5 n√∫meros!</p><p class="text-2xl font-bold text-green-600 mt-2">Pr√™mio: ${result.prize} MZN</p>`;
            } else if (result.status === 'Reembolso') {
                iconContainer.textContent = 'üí∞';
                titleContainer.textContent = 'Reembolso!';
                messageContainer.innerHTML = `<p class="text-blue-600">Voc√™ acertou 3 n√∫meros!</p><p class="text-xl font-bold text-blue-600 mt-2">Reembolso: ${result.prize} MZN</p>`;
            } else {
                iconContainer.textContent = 'üòî';
                titleContainer.textContent = 'N√£o foi desta vez';
                messageContainer.innerHTML = `<p class="text-gray-600">Voc√™ acertou ${result.matches} n√∫mero(s)</p><p class="text-sm text-gray-500 mt-2">Tente novamente!</p>`;
            }

            modal.classList.remove('hidden');
        }

        function closeResultModal() {
            document.getElementById('resultModal').classList.add('hidden');
        }

        // ========== EVENT LISTENERS ==========

        document.getElementById('loginFormElement').addEventListener('submit', (e) => {
            e.preventDefault();
            const mpesa = document.getElementById('loginMpesa').value;
            const password = document.getElementById('loginPassword').value;
            login(mpesa, password);
        });

        document.getElementById('registerFormElement').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const mpesa = document.getElementById('registerMpesa').value;
            const password = document.getElementById('registerPassword').value;
            register(name, mpesa, password);
        });

        // ========== INICIALIZA√á√ÉO ==========

        window.addEventListener('load', () => {
            const session = sessionStorage.getItem('rifa_session');
            if (session) {
                currentUser = JSON.parse(session);
                balance = parseInt(localStorage.getItem(`rifa_balance_${currentUser.mpesa}`) || INITIAL_BALANCE);
                showRifaScreen();
            }
        });
    </script>
</body>
</html>
